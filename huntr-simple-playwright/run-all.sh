#!/bin/bash

# Huntr.co Simple Playwright Test Runner
# Runs all exploration tests and generates summary report

echo "============================================"
echo "Huntr.co Simple Playwright Test Suite"
echo "============================================"
echo ""

# Check if .env exists
if [ ! -f .env ]; then
    echo "âŒ Error: .env file not found!"
    echo ""
    echo "Please create a .env file with:"
    echo "  HUNTR_EMAIL=your-email@example.com"
    echo "  HUNTR_PASSWORD=your-password"
    echo "  HUNTR_BOARD_ID=your-board-id"
    exit 1
fi

# Create results directory
mkdir -p huntr-simple-playwright/results/screenshots
mkdir -p huntr-simple-playwright/results/html

echo "Starting test execution..."
echo ""

START_TIME=$(date +%s)

# Run all tests with the correct config
echo "ðŸ“‹ Test 1/4: Basic Navigation..."
npx playwright test huntr-simple-playwright/basic-navigation.spec.ts --config=huntr-simple-playwright/playwright.config.ts --reporter=line

echo ""
echo "ðŸ“‹ Test 2/4: Job Details Exploration..."
npx playwright test huntr-simple-playwright/job-details.spec.ts --config=huntr-simple-playwright/playwright.config.ts --reporter=line

echo ""
echo "ðŸ“‹ Test 3/4: Resume Editor Exploration..."
npx playwright test huntr-simple-playwright/resume-editor.spec.ts --config=huntr-simple-playwright/playwright.config.ts --reporter=line

echo ""
echo "ðŸ“‹ Test 4/4: Modal Discovery..."
npx playwright test huntr-simple-playwright/modal-discovery.spec.ts --config=huntr-simple-playwright/playwright.config.ts --reporter=line

END_TIME=$(date +%s)
DURATION=$((END_TIME - START_TIME))

echo ""
echo "============================================"
echo "Test Execution Complete!"
echo "============================================"
echo ""
echo "â±ï¸  Total Time: ${DURATION} seconds"
echo ""
echo "ðŸ“Š Results saved to:"
echo "   - Screenshots: huntr-simple-playwright/results/screenshots/"
echo "   - HTML: huntr-simple-playwright/results/html/"
echo ""

# Count results
SCREENSHOT_COUNT=$(ls -1 huntr-simple-playwright/results/screenshots/*.png 2>/dev/null | wc -l)
HTML_COUNT=$(ls -1 huntr-simple-playwright/results/html/*.html 2>/dev/null | wc -l)

echo "âœ… Captured:"
echo "   - ${SCREENSHOT_COUNT} screenshots"
echo "   - ${HTML_COUNT} HTML files"
echo ""

# Generate summary
cat > huntr-simple-playwright/results/SUMMARY.md <<EOF
# Huntr.co Simple Playwright Test Results

**Date:** $(date)
**Duration:** ${DURATION} seconds (~$((DURATION / 60)) minutes)

## Results

- **Screenshots Captured:** ${SCREENSHOT_COUNT}
- **HTML Files Captured:** ${HTML_COUNT}
- **Total Pages Explored:** ${HTML_COUNT}

## Tests Executed

1. âœ… Basic Navigation - All main Huntr.co pages
2. âœ… Job Details Exploration - Job cards and detail views
3. âœ… Resume Editor Exploration - Resume builder and editor
4. âœ… Modal Discovery - Creation and edit modals

## Coverage Estimate

Based on captured pages, estimated coverage: **${HTML_COUNT} unique views**

Compare to AI-guided approach:
- AI-guided: 12 pages in ~100 minutes
- Simple Playwright: ${HTML_COUNT} pages in ~$((DURATION / 60)) minutes
- **Speed improvement: ~$((10000 / (DURATION / 60 + 1) / 10))x faster**

## Next Steps

1. Review screenshots in \`results/screenshots/\`
2. Review HTML captures in \`results/html/\`
3. Identify any missing areas
4. Add targeted tests for gaps
5. Integrate into CI/CD pipeline

---
Generated by Simple Playwright Test Suite
EOF

echo "ðŸ“„ Summary report: huntr-simple-playwright/results/SUMMARY.md"
echo ""
echo "âœ¨ Done! Check the results directory for captured pages."
